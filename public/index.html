<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Municipal BI Navigation</title>

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

html, body {
    width: 100vw;
    height: 100vh;
    background: #00253D;
    font-family: Arial, sans-serif;
    overflow: hidden;
    position: fixed;
}

/* כפתור מסך מלא – שמאל */
.top-left-buttons {
    position: fixed;
    top: 12px;
    left: 12px;
    z-index: 6000;
}

.top-btn {
    background: #0b3a53;
    color: white;
    padding: 8px 14px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
}

/* כפתור תפריט – ימין */
.top-right-button {
    position: fixed;
    top: 12px;
    right: 12px;
    z-index: 6000;  /* גבוה יותר מהתפריט הצד! */
}

/* תפריט צד */
.sidebar {
    position: fixed;
    top: 0;
    right: 0;
    width: 260px;
    height: 100vh;
    background: #001f33;
    color: white;
    transform: translateX(100%);
    transition: transform 0.3s ease;
    z-index: 5500;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.sidebar.open {
    transform: translateX(0);
}

.sidebar h2 {
    margin: 0;
    padding: 15px;
    background: #00334d;
    text-align: center;
    flex-shrink: 0;
}

.menu-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
}

.menu-btn {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 14px;
    border-bottom: 1px solid rgba(0, 51, 77, 0.5);
    cursor: pointer;
    text-align: center;
    font-size: 14px;
    transition: background 0.2s;
    min-height: 50px;
}

.menu-btn:hover {
    background: #004466;
}

.menu-btn.active {
    background: #003366;
    border-left: 4px solid #4fc3f7;
}

.menu-btn:last-child {
    border-bottom: none;
}

/* אזור ריבועים */
.main {
    width: 100vw;
    height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    position: fixed;
    top: 0;
    left: 0;
}

.tiles-wrapper {
    display: grid;
    grid-template-columns: repeat(8, 1fr);
    gap: 18px;
    width: calc(100% - 120px);
    max-width: 1600px;
}

.tile {
    width: 170px;
    height: 170px;
    border: 1px solid rgba(255,255,255,0.25);
    border-radius: 14px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 10px;
    color: white;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
}

.tile:hover {
    border-color: rgba(255,255,255,0.5);
    transform: scale(1.05);
}

.tile img {
    max-width: 64px;
    max-height: 64px;
    object-fit: contain;
}

/* כפתור תחתון */
.main-dashboard {
    margin-top: 40px;
    width: 360px;
    height: 120px;
    border: 1px solid rgba(255,255,255,0.35);
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 18px;
    cursor: pointer;
    transition: all 0.2s;
}

.main-dashboard:hover {
    border-color: rgba(255,255,255,0.6);
    transform: scale(1.02);
}

/* iframe נסתר לאימות מוקדם */
#preAuthFrame {
    position: fixed;
    width: 1px;
    height: 1px;
    top: -1000px;
    left: -1000px;
    opacity: 0;
    pointer-events: none;
}

/* iframe – תמיד 100% */
#reportFrame {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    border: none;
    display: none;
    z-index: 3000;
    background: #00253D;
}

/* מסך טעינה */
#loadingScreen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: #00253D;
    display: none;
    z-index: 3100;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    gap: 30px;
}

.hourglass-container {
    width: 120px;
    height: 168px;
    position: relative;
}

.hourglass {
    width: 100%;
    height: 100%;
    animation: flip 3s ease-in-out infinite;
    transform-origin: center;
}

@keyframes flip {
    0%, 45% {
        transform: rotate(0deg);
    }
    50%, 95% {
        transform: rotate(180deg);
    }
    100% {
        transform: rotate(180deg);
    }
}

.sand-stream {
    animation: sandFlow 3s ease-in-out infinite;
}

@keyframes sandFlow {
    0%, 45% {
        opacity: 0.7;
    }
    48%, 100% {
        opacity: 0;
    }
}

.sand-top {
    animation: sandTopEmpty 3s ease-in-out infinite;
    transform-origin: center;
}

@keyframes sandTopEmpty {
    0% {
        opacity: 0.9;
        transform: scaleY(1);
    }
    45% {
        opacity: 0.3;
        transform: scaleY(0.2);
    }
    50%, 100% {
        opacity: 0.9;
        transform: scaleY(1);
    }
}

.sand-bottom {
    animation: sandBottomFill 3s ease-in-out infinite;
    transform-origin: center bottom;
}

@keyframes sandBottomFill {
    0% {
        opacity: 0.3;
        transform: scaleY(0.2);
    }
    45% {
        opacity: 0.9;
        transform: scaleY(1);
    }
    50% {
        opacity: 0.3;
        transform: scaleY(0.2);
    }
    100% {
        opacity: 0.9;
        transform: scaleY(1);
    }
}

.hourglass-frame {
    filter: drop-shadow(0 0 10px rgba(79, 195, 247, 0.5));
}

.loading-text {
    color: white;
    font-size: 24px;
    font-weight: 300;
    letter-spacing: 2px;
}

.loading-dots {
    display: inline-block;
    width: 60px;
    text-align: left;
}

@keyframes dotAnimation {
    0%, 20% { content: '.'; }
    40% { content: '..'; }
    60%, 100% { content: '...'; }
}

.loading-dots::after {
    content: '';
    animation: dotAnimation 1.5s infinite;
}

/* הודעת כניסה למסך מלא */
#fullscreenPrompt {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 37, 61, 0.95);
    display: none;
    z-index: 7000;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    gap: 30px;
}

.prompt-btn {
    background: #4fc3f7;
    color: #00253D;
    padding: 20px 50px;
    font-size: 24px;
    font-weight: bold;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.2s;
}

.prompt-btn:hover {
    background: #81d4fa;
    transform: scale(1.05);
}

.prompt-text {
    color: white;
    font-size: 20px;
    text-align: center;
}
</style>
</head>

<body>

<!-- iframe נסתר לאימות מוקדם -->
<iframe id="preAuthFrame"></iframe>

<!-- כפתורים -->
<div class="top-left-buttons">
    <div class="top-btn" id="fullscreenBtn" onclick="toggleFullscreen()">⛶ מסך מלא</div>
</div>

<div class="top-right-button">
    <div class="top-btn" onclick="toggleSidebar()">☰</div>
</div>

<!-- תפריט צד -->
<div id="sidebar" class="sidebar">
    <h2>ניווט</h2>
    <div class="menu-container">
        <div class="menu-btn" data-report="cityPopulation" onclick="loadReportWithFullscreen('cityPopulation')">מרשם אוכלוסין עיר</div>
        <div class="menu-btn" data-report="neighborhoodPopulation" onclick="loadReportWithFullscreen('neighborhoodPopulation')">מרשם אוכלוסין שכונה</div>
        <div class="menu-btn" data-report="vehicles" onclick="loadReportWithFullscreen('vehicles')">רכבים עירוניים</div>
        <div class="menu-btn" data-report="garbage" onclick="loadReportWithFullscreen('garbage')">פינוי אשפה ומיחזור</div>
        <div class="menu-btn" data-report="water" onclick="loadReportWithFullscreen('water')">צריכת מים והשקייה</div>
        <div class="menu-btn" data-report="appointments" onclick="loadReportWithFullscreen('appointments')">זימון תורים</div>
        <div class="menu-btn" data-report="arnona" onclick="loadReportWithFullscreen('arnona')">ארנונה</div>
        <div class="menu-btn" data-report="transport" onclick="loadReportWithFullscreen('transport')">הסעות עירוניות</div>
        <div class="menu-btn" data-report="businessLicensing" onclick="loadReportWithFullscreen('businessLicensing')">רישוי עסקים</div>
        <div class="menu-btn" data-report="businessPromotion" onclick="loadReportWithFullscreen('businessPromotion')">קידום עסקים</div>
        <div class="menu-btn" data-report="parking" onclick="loadReportWithFullscreen('parking')">תחבורה וחנייה</div>
        <div class="menu-btn" data-report="emergency" onclick="loadReportWithFullscreen('emergency')">בקרת חירום</div>
        <div class="menu-btn" data-report="crime" onclick="loadReportWithFullscreen('crime')">פשיעה ואכיפה</div>
        <div class="menu-btn" data-report="center106" onclick="loadReportWithFullscreen('center106')">מוקד 106</div>
        <div class="menu-btn" data-report="benchmark" onclick="loadReportWithFullscreen('benchmark')">מדרג רשויות</div>
        <div class="menu-btn" data-report="employment" onclick="loadReportWithFullscreen('employment')">תעסוקה עירונית</div>
        <div class="menu-btn" data-report="main" onclick="loadReportWithFullscreen('main')">לוח בקרה ראשי</div>
    </div>
</div>

<!-- ריבועים -->
<div class="main">
    <div class="tiles-wrapper">
        <div class="tile" onclick="loadReportWithFullscreen('cityPopulation')"><span>מרשם אוכלוסין עיר</span></div>
        <div class="tile" onclick="loadReportWithFullscreen('neighborhoodPopulation')"><span>מרשם אוכלוסין שכונה</span></div>
        <div class="tile" onclick="loadReportWithFullscreen('vehicles')"><span>רכבים עירוניים</span></div>
        <div class="tile" onclick="loadReportWithFullscreen('garbage')"><span>פינוי אשפה</span></div>
        <div class="tile" onclick="loadReportWithFullscreen('water')"><span>צריכת מים</span></div>
        <div class="tile" onclick="loadReportWithFullscreen('appointments')"><span>זימון תורים</span></div>
        <div class="tile" onclick="loadReportWithFullscreen('arnona')"><span>ארנונה</span></div>
        <div class="tile" onclick="loadReportWithFullscreen('transport')"><span>הסעות עירוניות</span></div>
        <div class="tile" onclick="loadReportWithFullscreen('businessLicensing')"><span>רישוי עסקים</span></div>
        <div class="tile" onclick="loadReportWithFullscreen('businessPromotion')"><span>קידום עסקים</span></div>
        <div class="tile" onclick="loadReportWithFullscreen('parking')"><span>תחבורה וחנייה</span></div>
        <div class="tile" onclick="loadReportWithFullscreen('emergency')"><span>בקרת חירום</span></div>
        <div class="tile" onclick="loadReportWithFullscreen('crime')"><span>פשיעה ואכיפה</span></div>
        <div class="tile" onclick="loadReportWithFullscreen('center106')"><span>מוקד 106</span></div>
        <div class="tile" onclick="loadReportWithFullscreen('benchmark')"><span>מדרג רשויות</span></div>
        <div class="tile" onclick="loadReportWithFullscreen('employment')"><span>תעסוקה עירונית</span></div>
    </div>

    <div class="main-dashboard" onclick="loadReportWithFullscreen('main')">
        לוח בקרה ראשי
    </div>
</div>

<!-- מסך טעינה -->
<div id="loadingScreen">
    <div class="hourglass-container">
        <svg class="hourglass" viewBox="0 0 120 168" xmlns="http://www.w3.org/2000/svg">
            <g class="hourglass-frame">
                <path d="M20 10 L100 10 L100 20 L95 25 L95 70 L60 85 L95 100 L95 145 L100 150 L100 160 L20 160 L20 150 L25 145 L25 100 L60 85 L25 70 L25 25 L20 20 Z" 
                      fill="none" stroke="#4fc3f7" stroke-width="2"/>
            </g>
            <g class="sand-top">
                <path d="M30 25 L90 25 L90 30 Q90 50 60 65 Q30 50 30 30 Z" 
                      fill="#ffb74d" opacity="0.9"/>
            </g>
            <g class="sand-bottom">
                <path d="M30 145 L90 145 L90 140 Q90 130 85 120 L35 120 Q30 130 30 140 Z" 
                      fill="#ffb74d" opacity="0.9"/>
            </g>
            <g class="sand-stream">
                <line x1="60" y1="70" x2="60" y2="100" 
                      stroke="#ffb74d" stroke-width="2" opacity="0.7"/>
            </g>
        </svg>
    </div>
    
    <div class="loading-text">
        טעינה<span class="loading-dots"></span>
    </div>
</div>

<!-- הודעת כניסה למסך מלא -->
<div id="fullscreenPrompt">
    <div class="prompt-text">לחץ להמשך במסך מלא</div>
    <button class="prompt-btn" onclick="enterFullscreenFromPrompt()">▶ המשך</button>
</div>

<iframe id="reportFrame"></iframe>

<script>
const URLS = {
    cityPopulation: "https://app.powerbi.com/reportEmbed?reportId=7719ef70-1954-4d51-8c54-6da0501d9ae0&autoAuth=true&ctid=a8bf01d5-f36b-4b08-ad19-18fe50aa833c&navContentPaneEnabled=false&language=en-US",
    neighborhoodPopulation: "https://app.powerbi.com/reportEmbed?reportId=a2d09f47-b8f0-4aa1-b5f7-cf2b01001086&autoAuth=true&ctid=a8bf01d5-f36b-4b08-ad19-18fe50aa833c&navContentPaneEnabled=false&language=en-US",
    vehicles: "https://app.powerbi.com/reportEmbed?reportId=a4ec7683-19f1-45e9-8e1c-6e9aaeb55bc9&autoAuth=true&ctid=a8bf01d5-f36b-4b08-ad19-18fe50aa833c&navContentPaneEnabled=false&language=en-US",
    garbage: "https://app.powerbi.com/reportEmbed?reportId=d975dff7-b2e3-450e-9399-569719e6734d&autoAuth=true&ctid=a8bf01d5-f36b-4b08-ad19-18fe50aa833c&navContentPaneEnabled=false&language=en-US",
    water: "https://app.powerbi.com/reportEmbed?reportId=db1d38ec-8b52-4a44-865c-a5109c9f9d4c&autoAuth=true&ctid=a8bf01d5-f36b-4b08-ad19-18fe50aa833c&navContentPaneEnabled=false&language=en-US",
    appointments: "https://app.powerbi.com/reportEmbed?reportId=74ebfd2d-c849-4212-aa50-f76aedc0e9af&autoAuth=true&ctid=a8bf01d5-f36b-4b08-ad19-18fe50aa833c&navContentPaneEnabled=false&language=en-US",
    arnona: "https://app.powerbi.com/reportEmbed?reportId=99746334-ff4a-43a9-be32-0caf768e06b7&autoAuth=true&ctid=a8bf01d5-f36b-4b08-ad19-18fe50aa833c&navContentPaneEnabled=false&language=en-US",
    transport: "https://app.powerbi.com/reportEmbed?reportId=92eef28d-b435-4601-bc70-a26972596b45&autoAuth=true&ctid=a8bf01d5-f36b-4b08-ad19-18fe50aa833c&navContentPaneEnabled=false&language=en-US",
    businessLicensing: "https://app.powerbi.com/reportEmbed?reportId=96ef81a4-4e65-4d96-a41e-e017d56673e8&autoAuth=true&ctid=a8bf01d5-f36b-4b08-ad19-18fe50aa833c&navContentPaneEnabled=false&language=en-US",
    businessPromotion: "https://app.powerbi.com/reportEmbed?reportId=96209590-0917-4096-85cd-e4fe97acc6a6&autoAuth=true&ctid=a8bf01d5-f36b-4b08-ad19-18fe50aa833c&navContentPaneEnabled=false&language=en-US",
    parking: "https://app.powerbi.com/reportEmbed?reportId=593c46a6-2e79-44d2-9bab-8080d24fba96&autoAuth=true&ctid=a8bf01d5-f36b-4b08-ad19-18fe50aa833c&navContentPaneEnabled=false&language=en-US",
    emergency: "https://app.powerbi.com/reportEmbed?reportId=ad06f4e7-ede5-4661-8d25-58eccd4f6e75&autoAuth=true&ctid=a8bf01d5-f36b-4b08-ad19-18fe50aa833c&navContentPaneEnabled=false&language=en-US",
    crime: "https://app.powerbi.com/reportEmbed?reportId=56348d10-c389-43cd-bcb0-5ae3a3f81cc1&autoAuth=true&ctid=a8bf01d5-f36b-4b08-ad19-18fe50aa833c&navContentPaneEnabled=false&language=en-US",
    center106: "https://app.powerbi.com/reportEmbed?reportId=64931d9d-2edc-4f93-b57b-ddbd351674b5&autoAuth=true&ctid=a8bf01d5-f36b-4b08-ad19-18fe50aa833c&navContentPaneEnabled=false&language=en-US",
    benchmark: "https://app.powerbi.com/reportEmbed?reportId=5776724a-ef63-4a9c-9568-748a30bd1337&autoAuth=true&ctid=a8bf01d5-f36b-4b08-ad19-18fe50aa833c&navContentPaneEnabled=false&language=en-US",
    employment: "https://app.powerbi.com/reportEmbed?reportId=2490a2be-c6c6-47d0-9ea5-59274756f258&autoAuth=true&ctid=a8bf01d5-f36b-4b08-ad19-18fe50aa833c&navContentPaneEnabled=false&language=en-US",
    main: "https://app.powerbi.com/reportEmbed?reportId=cff48281-a598-4bab-96d7-b4ddc8e69e66&autoAuth=true&ctid=a8bf01d5-f36b-4b08-ad19-18fe50aa833c&navContentPaneEnabled=false&language=en-US"
};

let loadingTimeout;
let currentReportKey = "";

// טעינת iframe נסתר לאימות מוקדם
window.addEventListener('load', function() {
    const preAuthFrame = document.getElementById('preAuthFrame');
    // טוען את הדשבורד הראשון ברקע כדי להפעיל את האימות
    preAuthFrame.src = URLS.main;
});

function toggleSidebar() {
    document.getElementById("sidebar").classList.toggle("open");
}

function loadReportWithFullscreen(reportKey) {
    currentReportKey = reportKey;
    loadReport(URLS[reportKey]);
    markActiveReport(reportKey);
    
    // הצגת הודעת מסך מלא
    document.getElementById('fullscreenPrompt').style.display = 'flex';
}

function loadReport(url) {
    const frame = document.getElementById("reportFrame");
    const loadingScreen = document.getElementById("loadingScreen");
    const sidebar = document.getElementById("sidebar");
    
    sidebar.classList.remove("open");
    
    if (loadingTimeout) {
        clearTimeout(loadingTimeout);
    }
    
    loadingScreen.style.display = "flex";
    
    frame.src = url;
    frame.style.display = "block";
    
    loadingTimeout = setTimeout(() => {
        loadingScreen.style.display = "none";
    }, 15000);
}

function markActiveReport(reportKey) {
    document.querySelectorAll('.menu-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    const activeBtn = document.querySelector(`.menu-btn[data-report="${reportKey}"]`);
    if (activeBtn) {
        activeBtn.classList.add('active');
    }
}

function enterFullscreenFromPrompt() {
    document.getElementById('fullscreenPrompt').style.display = 'none';
    
    if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().catch(err => {
            console.log('Fullscreen failed:', err);
        });
    }
}

document.getElementById("reportFrame").addEventListener("load", function() {
    const loadingScreen = document.getElementById("loadingScreen");
    
    setTimeout(() => {
        loadingScreen.style.display = "none";
        if (loadingTimeout) {
            clearTimeout(loadingTimeout);
        }
    }, 3000);
});

function toggleFullscreen() {
    if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
    } else {
        document.exitFullscreen();
    }
}

document.addEventListener("fullscreenchange", () => {
    document.getElementById("fullscreenBtn").textContent =
        document.fullscreenElement ? "✖ יציאה ממסך מלא" : "⛶ מסך מלא";
});

// זיהוי חזרה מפופאפ
window.addEventListener('focus', function() {
    if (currentReportKey && !document.fullscreenElement) {
        // אם יצאנו ממסך מלא (בגלל פופאפ), נציג שוב את ההודעה
        setTimeout(() => {
            if (!document.fullscreenElement) {
                document.getElementById('fullscreenPrompt').style.display = 'flex';
            }
        }, 1000);
    }
});
</script>

</body>
</html>
